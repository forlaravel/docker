server {
   listen 8000 default_server;
   listen [::]:8000 default_server;
   server_name localhost;
   server_tokens off;

   charset utf-8;
   client_max_body_size 2G;
   root /app/public;

   add_header X-Frame-Options "SAMEORIGIN";
   add_header X-Content-Type-Options "nosniff";
   add_header Referrer-Policy "strict-origin-when-cross-origin";
   add_header X-XSS-Protection "1; mode=block";
   add_header Permissions-Policy "camera=(), microphone=(), geolocation=()";

   index index.php;

   # Maintenance page for when backend is not ready (502/504 errors)
   error_page 502 504 /maintenance/maintenance.html;

   location = /maintenance/maintenance.html {
      root /etc/nginx;
      internal;
   }

   location /basic_status {
      stub_status;
      allow 127.0.0.1;
      allow ::1;
      deny all;
   }

   location / {
      try_files $uri $uri/ /index.php?$query_string;
   }

   location = /favicon.ico { access_log off; log_not_found off; }
   location = /robots.txt  { access_log off; log_not_found off; }

   access_log /dev/stdout combined;
   error_log /dev/stderr warn;

   error_page 404 /index.php;

   include /etc/nginx/php-fpm-handler.conf;

   location ~ /\.(?!well-known).* {
      deny all;
   }
}

server {
   listen 8443 ssl default_server;
   listen [::]:8443 ssl default_server;
   server_name localhost;
   server_tokens off;

   ssl_certificate /etc/nginx/ssl/selfsigned.crt;
   ssl_certificate_key /etc/nginx/ssl/selfsigned.key;

   charset utf-8;
   client_max_body_size 2G;
   root /app/public;

   add_header X-Frame-Options "SAMEORIGIN";
   add_header X-Content-Type-Options "nosniff";
   add_header Referrer-Policy "strict-origin-when-cross-origin";
   add_header X-XSS-Protection "1; mode=block";
   add_header Permissions-Policy "camera=(), microphone=(), geolocation=()";

   index index.php;

   # Maintenance page for when backend is not ready (502/504 errors)
   error_page 502 504 /maintenance/maintenance.html;

   location = /maintenance/maintenance.html {
      root /etc/nginx;
      internal;
   }

   location /basic_status {
      stub_status;
      allow 127.0.0.1;
      allow ::1;
      deny all;
   }

   location / {
      try_files $uri $uri/ /index.php?$query_string;
   }

   location = /favicon.ico { access_log off; log_not_found off; }
   location = /robots.txt  { access_log off; log_not_found off; }

   access_log /dev/stdout combined;
   error_log /dev/stderr warn;

   error_page 404 /index.php;

   include /etc/nginx/php-fpm-handler.conf;

   location ~ /\.(?!well-known).* {
      deny all;
   }
}
